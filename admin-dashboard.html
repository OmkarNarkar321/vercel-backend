<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#FFF2E9 0%,#FFE4D6 100%);min-height:100vh}
    .dashboard-container{display:flex;height:100vh}
    .sidebar{width:260px;background:linear-gradient(135deg,#ED9455 0%,#A7561C 100%);color:white;padding:20px;box-shadow:2px 0 10px rgba(0,0,0,.1);overflow-y:auto}
    .sidebar-header{text-align:center;padding:20px 0;border-bottom:1px solid rgba(255,255,255,.2);margin-bottom:20px}
    .sidebar-header h2{font-size:24px;margin-bottom:5px}
    .sidebar-header p{font-size:14px;opacity:.8}
    .menu-item{padding:15px 20px;margin:8px 0;border-radius:8px;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:12px}
    .menu-item:hover{background:rgba(255,255,255,.1);transform:translateX(5px)}
    .menu-item.active{background:rgba(255,255,255,.2);box-shadow:0 4px 8px rgba(0,0,0,.2)}
    .menu-icon{font-size:20px}
    .main-content{flex:1;padding:30px;overflow-y:auto;background:linear-gradient(135deg,#FFF2E9 0%,#FFE4D6 100%)}
    .top-bar{background:white;padding:20px 30px;border-radius:20px;box-shadow:0 5px 15px rgba(0,0,0,.08);margin-bottom:30px;display:flex;justify-content:space-between;align-items:center}
    .top-bar h1{color:#ED9455;font-size:32px}
    .refresh-btn{background:linear-gradient(135deg,#ED9455 0%,#A7561C 100%);color:white;border:none;padding:12px 30px;border-radius:25px;cursor:pointer;font-size:16px;font-weight:600;box-shadow:0 5px 15px rgba(237,148,85,.3);transition:transform .2s,box-shadow .2s}
    .refresh-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(237,148,85,.4)}
    .content-section{display:none}
    .content-section.active{display:block}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
    .stat-card{background:white;padding:25px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.08);transition:transform .3s}
    .stat-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,.12)}
    .stat-card h3{color:#ED9455;font-size:14px;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px}
    .stat-card .number{font-size:32px;font-weight:bold;color:#333}
    .data-container{background:white;padding:25px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
    .data-container h2{color:#ED9455;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0;font-size:24px}
    .search-filter{margin-bottom:20px}
    .search-filter input{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:border-color .3s}
    .search-filter input:focus{outline:none;border-color:#ED9455}
    table{width:100%;border-collapse:collapse}
    thead{background:linear-gradient(135deg,#ED9455 0%,#A7561C 100%)}
    th,td{padding:15px;text-align:left;border-bottom:1px solid #eee}
    th{font-weight:600;color:white;text-transform:uppercase;font-size:12px}
    tbody tr{transition:background-color .2s}
    tbody tr:hover{background:#FFF5EE}
    .badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:500}
    .badge-success{background:#E8F5E9;color:#388E3C}
    .badge-pending{background:#FFF3E0;color:#F57C00}
    .badge-info{background:#FFE4D6;color:#A7561C}
    .no-data{text-align:center;padding:40px;color:#999}
    .view-btn{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:12px;background:#ED9455;color:white;transition:all .3s}
    .view-btn:hover{background:#D97D3D;transform:scale(1.05)}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:white;padding:30px;border-radius:15px;max-width:600px;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.3)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
    .modal-header h2{color:#ED9455}
    .close-btn{cursor:pointer;font-size:24px;color:#999;transition:color .3s}
    .close-btn:hover{color:#ED9455}
    .detail-row{margin-bottom:15px;padding:10px;background:#FFF5EE;border-radius:8px;border-left:3px solid #ED9455}
    .detail-label{font-weight:600;color:#ED9455;margin-bottom:5px}
    .detail-value{color:#333;line-height:1.6}
    .status-badge{padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase}
    .status-new{background:#E3F2FD;color:#1976D2}
    .status-in-progress{background:#FFF3E0;color:#F57C00}
    .status-resolved{background:#E8F5E9;color:#388E3C}
    .status-closed{background:#ECEFF1;color:#607D8B}
    @media (max-width:768px){.dashboard-container{flex-direction:column}.sidebar{width:100%}}
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>üéì Admin Panel</h2>
        <p>College Management System</p>
      </div>
      <div class="menu-item active" onclick="showSection('dashboard')"><span class="menu-icon">üìä</span><span>Dashboard</span></div>
      <div class="menu-item" onclick="showSection('students')"><span class="menu-icon">üë®‚Äçüéì</span><span>Students</span></div>
      <div class="menu-item" onclick="showSection('contact')"><span class="menu-icon">üìß</span><span>Contact Messages</span></div>
      <div class="menu-item" onclick="showSection('counseling')"><span class="menu-icon">üéØ</span><span>Counseling Requests</span></div>
    </div>
    <div class="main-content">
      <div class="top-bar">
        <h1 id="page-title">üìä Dashboard Overview</h1>
        <button class="refresh-btn" onclick="loadAllData()">üîÑ Refresh</button>
      </div>
      <div id="dashboard" class="content-section active">
        <div class="stats-grid">
          <div class="stat-card"><h3>Total Students</h3><div class="number" id="total-students">0</div></div>
          <div class="stat-card"><h3>Contact Messages</h3><div class="number" id="total-contacts">0</div></div>
          <div class="stat-card"><h3>Counseling Requests</h3><div class="number" id="total-counseling">0</div></div>
          <div class="stat-card"><h3>Total Records</h3><div class="number" id="total-records">0</div></div>
        </div>
        <div class="data-container"><h2>üìà Recent Activity</h2><div id="recent-activity"></div></div>
      </div>
      <div id="students" class="content-section">
        <div class="data-container">
          <h2>üë®‚Äçüéì Registered Students</h2>
          <div class="search-filter"><input type="text" id="student-search" placeholder="Search students..."></div>
          <div id="students-table"></div>
        </div>
      </div>
      <div id="contact" class="content-section">
        <div class="data-container">
          <h2>üìß Contact Form Messages</h2>
          <div class="search-filter"><input type="text" id="contact-search" placeholder="Search messages..."></div>
          <div id="contact-table"></div>
        </div>
      </div>
      <div id="counseling" class="content-section">
        <div class="data-container">
          <h2>üéØ Counseling Appointment Requests</h2>
          <div class="search-filter"><input type="text" id="counseling-search" placeholder="Search requests..."></div>
          <div id="counseling-table"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 id="modal-title">Details</h2><span class="close-btn" onclick="closeModal()">√ó</span></div>
      <div id="modal-body"></div>
    </div>
  </div>
  <script>
    const API='http://localhost:5000/api';
    let students=[],contacts=[],counseling=[];
    const titles={dashboard:'üìä Dashboard Overview',students:'üë®‚Äçüéì Registered Students',contact:'üìß Contact Messages',counseling:'üéØ Counseling Requests'};
    
    function showSection(s){
      document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
      event.target.closest('.menu-item').classList.add('active');
      document.querySelectorAll('.content-section').forEach(i=>i.classList.remove('active'));
      document.getElementById(s).classList.add('active');
      document.getElementById('page-title').textContent=titles[s];
    }
    
    async function loadAllData(){
      try{
        const [s,c,co]=await Promise.all([
          fetch(`${API}/auth/students`).then(r=>r.json()),
          fetch(`${API}/contact/messages`).then(r=>r.json()),
          fetch(`${API}/counseling/requests`).then(r=>r.json())
        ]);
        students=s.data||[];contacts=c.data||[];counseling=co.data||[];
        renderStudents(students);renderContacts(contacts);renderCounseling(counseling);
        updateDashboard();
      }catch(e){console.error(e)}
    }
    
    function updateDashboard(){
      document.getElementById('total-students').textContent=students.length;
      document.getElementById('total-contacts').textContent=contacts.length;
      document.getElementById('total-counseling').textContent=counseling.length;
      document.getElementById('total-records').textContent=students.length+contacts.length+counseling.length;
      const recent=[...contacts.slice(0,3).map(c=>({type:'Contact',name:c.name,date:c.createdAt})),
        ...counseling.slice(0,3).map(c=>({type:'Counseling',name:c.fullName,date:c.createdAt}))]
        .sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,5);
      let html='<table><thead><tr><th>Type</th><th>Name</th><th>Date</th></tr></thead><tbody>';
      recent.forEach(i=>html+=`<tr><td><span class="badge badge-info">${i.type}</span></td><td>${i.name}</td><td>${new Date(i.date).toLocaleDateString()}</td></tr>`);
      document.getElementById('recent-activity').innerHTML=html+'</tbody></table>'||'<div class="no-data">No recent activity</div>';
    }
    
    function renderStudents(data){
      if(!data||!data.length){document.getElementById('students-table').innerHTML='<div class="no-data">No students found</div>';return}
      let html='<table><thead><tr><th>Name</th><th>Email</th><th>Mobile</th><th>Gender</th><th>Type</th><th>Registered</th><th>Action</th></tr></thead><tbody>';
      data.forEach(s=>html+=`<tr><td>${s.fullName}</td><td>${s.email}</td><td>${s.personalInfo?.mobileNo||'N/A'}</td><td>${s.personalInfo?.gender||'N/A'}</td><td><span class="badge badge-info">${s.userType||'student'}</span></td><td>${new Date(s.createdAt).toLocaleDateString()}</td><td><button class="view-btn" onclick='viewStudent(${JSON.stringify(s).replace(/'/g,"&#39;")})'>View</button></td></tr>`);
      document.getElementById('students-table').innerHTML=html+'</tbody></table>';
    }
    
    function renderContacts(data){
      if(!data||!data.length){document.getElementById('contact-table').innerHTML='<div class="no-data">No messages found</div>';return}
      let html='<table><thead><tr><th>Name</th><th>Email</th><th>Subject</th><th>Status</th><th>Date</th><th>Action</th></tr></thead><tbody>';
      data.forEach(c=>html+=`<tr><td>${c.name}</td><td>${c.email}</td><td>${c.subject}</td><td><span class="status-badge status-${c.status}">${c.status}</span></td><td>${new Date(c.createdAt).toLocaleDateString()}</td><td><button class="view-btn" onclick='viewContact(${JSON.stringify(c).replace(/'/g,"&#39;")})'>View</button></td></tr>`);
      document.getElementById('contact-table').innerHTML=html+'</tbody></table>';
    }
    
    function renderCounseling(data){
      if(!data||!data.length){document.getElementById('counseling-table').innerHTML='<div class="no-data">No requests found</div>';return}
      let html='<table><thead><tr><th>Name</th><th>Email</th><th>Points</th><th>Status</th><th>Date</th><th>Action</th></tr></thead><tbody>';
      data.forEach(r=>html+=`<tr><td>${r.fullName}</td><td>${r.email}</td><td>${r.counselingPoints.substring(0,50)}${r.counselingPoints.length>50?'...':''}</td><td><span class="badge badge-pending">${r.status||'pending'}</span></td><td>${new Date(r.createdAt).toLocaleDateString()}</td><td><button class="view-btn" onclick='viewCounseling(${JSON.stringify(r).replace(/'/g,"&#39;")})'>View</button></td></tr>`);
      document.getElementById('counseling-table').innerHTML=html+'</tbody></table>';
    }
    
    function viewStudent(s){
      document.getElementById('modal-title').textContent='Student Details';
      let edu=s.education&&s.education.length?s.education.map(e=>`<div class="detail-row"><div class="detail-label">Course</div><div class="detail-value">${e.courseName} at ${e.college} (${e.from||'N/A'} - ${e.to||'N/A'})</div></div>`).join(''):'';
      let skills=s.skills&&s.skills.length?`<div class="detail-row"><div class="detail-label">Skills</div><div class="detail-value">${s.skills.join(', ')}</div></div>`:'';
      document.getElementById('modal-body').innerHTML=`<div class="detail-row"><div class="detail-label">Full Name</div><div class="detail-value">${s.fullName}</div></div><div class="detail-row"><div class="detail-label">Email</div><div class="detail-value">${s.email}</div></div><div class="detail-row"><div class="detail-label">Mobile</div><div class="detail-value">${s.personalInfo?.mobileNo||'N/A'}</div></div><div class="detail-row"><div class="detail-label">Address</div><div class="detail-value">${s.personalInfo?.address||'N/A'}</div></div><div class="detail-row"><div class="detail-label">Gender</div><div class="detail-value">${s.personalInfo?.gender||'N/A'}</div></div><div class="detail-row"><div class="detail-label">DOB</div><div class="detail-value">${s.personalInfo?.dateOfBirth?new Date(s.personalInfo.dateOfBirth).toLocaleDateString():'N/A'}</div></div>${edu}${skills}<div class="detail-row"><div class="detail-label">Registered</div><div class="detail-value">${new Date(s.createdAt).toLocaleString()}</div></div>`;
      openModal();
    }
    
    function viewContact(c){
      document.getElementById('modal-title').textContent='Contact Message';
      document.getElementById('modal-body').innerHTML=`<div class="detail-row"><div class="detail-label">Name</div><div class="detail-value">${c.name}</div></div><div class="detail-row"><div class="detail-label">Email</div><div class="detail-value">${c.email}</div></div><div class="detail-row"><div class="detail-label">Subject</div><div class="detail-value">${c.subject}</div></div><div class="detail-row"><div class="detail-label">Message</div><div class="detail-value">${c.message}</div></div><div class="detail-row"><div class="detail-label">Status</div><div class="detail-value"><span class="status-badge status-${c.status}">${c.status}</span></div></div><div class="detail-row"><div class="detail-label">Date</div><div class="detail-value">${new Date(c.createdAt).toLocaleString()}</div></div>`;
      openModal();
    }
    
    function viewCounseling(r){
      document.getElementById('modal-title').textContent='Counseling Request';
      document.getElementById('modal-body').innerHTML=`<div class="detail-row"><div class="detail-label">Name</div><div class="detail-value">${r.fullName}</div></div><div class="detail-row"><div class="detail-label">Email</div><div class="detail-value">${r.email}</div></div><div class="detail-row"><div class="detail-label">Points</div><div class="detail-value">${r.counselingPoints}</div></div><div class="detail-row"><div class="detail-label">Status</div><div class="detail-value"><span class="badge badge-pending">${r.status||'pending'}</span></div></div><div class="detail-row"><div class="detail-label">Date</div><div class="detail-value">${new Date(r.createdAt).toLocaleString()}</div></div>`;
      openModal();
    }
    
    function openModal(){document.getElementById('modal').classList.add('active')}
    function closeModal(){document.getElementById('modal').classList.remove('active')}
    
    document.getElementById('student-search').addEventListener('input',e=>{
      const q=e.target.value.toLowerCase();
      renderStudents(students.filter(s=>s.fullName.toLowerCase().includes(q)||s.email.toLowerCase().includes(q)||(s.personalInfo?.mobileNo&&s.personalInfo.mobileNo.includes(q))));
    });
    
    document.getElementById('contact-search').addEventListener('input',e=>{
      const q=e.target.value.toLowerCase();
      renderContacts(contacts.filter(c=>c.name.toLowerCase().includes(q)||c.email.toLowerCase().includes(q)||c.subject.toLowerCase().includes(q)));
    });
    
    document.getElementById('counseling-search').addEventListener('input',e=>{
      const q=e.target.value.toLowerCase();
      renderCounseling(counseling.filter(c=>c.fullName.toLowerCase().includes(q)||c.email.toLowerCase().includes(q)||c.counselingPoints.toLowerCase().includes(q)));
    });
    
    document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal')closeModal()});
    
    loadAllData();
  </script>
</body>
</html>